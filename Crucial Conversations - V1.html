<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guía Interactiva: Conversaciones Cruciales</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light blue-gray background */
        }
        .flow-card {
            background-color: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease-in-out;
            border: 1px solid #e5e7eb;
        }
        .flow-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .flow-arrow {
            color: #9ca3af; /* Gray-400 */
            margin: 1.5rem 0;
            text-align: center;
        }
        .phase-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #4b5563; /* Gray-600 */
            margin-bottom: 1rem;
            text-align: center;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease-in-out;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            max-width: 90%;
            width: 550px;
            transform: scale(0.95);
            transition: all 0.3s ease-in-out;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-overlay.active .modal-content {
            transform: scale(1);
        }
        .detail-item {
            cursor: pointer;
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            transition: all 0.2s ease;
        }
        .detail-item:hover {
            background-color: #f3f4f6;
            border-color: #d1d5db;
        }
        .path-button {
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: 600;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }
        .path-button-yes {
            background-color: #fef2f2; /* Red-50 */
            color: #b91c1c; /* Red-700 */
        }
        .path-button-yes:hover {
            background-color: #fee2e2; /* Red-100 */
            border-color: #fca5a5; /* Red-300 */
        }
        .path-button-no {
            background-color: #ecfdf5; /* Green-50 */
            color: #047857; /* Green-700 */
        }
        .path-button-no:hover {
            background-color: #d1fae5; /* Green-100 */
            border-color: #6ee7b7; /* Green-300 */
        }
        .modal-body-content h4 {
            font-weight: 700;
            color: #1f2937;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }
        .prep-textarea {
            width: 100%;
            margin-top: 0.5rem;
            padding: 0.75rem;
            border-radius: 0.75rem;
            border: 1px solid #d1d5db;
            transition: all 0.2s ease;
            font-size: 1rem;
        }
        .prep-textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.4);
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div id="mainContent" class="max-w-4xl mx-auto">
        <header class="text-center mb-12">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Guía Interactiva de Conversaciones Cruciales</h1>
            <p class="text-gray-500 mt-2">Navega el flujo para manejar diálogos difíciles de forma efectiva, con contexto del libro.</p>
        </header>

        <!-- FASE 1 -->
        <section id="fase1" class="mb-8">
            <h2 class="phase-title"><span class="bg-sky-100 text-sky-700 px-3 py-1 rounded-full">FASE 1: PREPARACIÓN</span></h2>
            <div class="flow-card">
                <h3 class="font-bold text-xl text-gray-800 mb-3 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-sky-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
                    Empezar por el Corazón
                </h3>
                <p class="text-gray-600 mb-4">Antes de hablar, aclara tus intenciones. El primer principio es que la gente hábil empieza por el corazón. Se centran primero en ellos mismos, incluso cuando el otro es el que parece ser el problema.</p>
                <ul class="list-disc list-inside space-y-2 text-gray-700">
                    <li>¿Qué quiero <strong>realmente</strong> para mí?</li>
                    <li>¿Qué quiero <strong>realmente</strong> para la otra persona?</li>
                    <li>¿Qué quiero <strong>realmente</strong> para nuestra relación?</li>
                </ul>
                <div class="mt-4 bg-sky-50 border-l-4 border-sky-400 text-sky-800 p-3 rounded-r-lg">
                    <strong>Consejo Clave:</strong> Busca el "Y". Rechaza la "elección del tonto" (ganar vs. perder, honestidad vs. paz). Pregúntate: "¿Cómo puedo lograr mis objetivos **Y** mantener una buena relación?".
                </div>
            </div>
        </section>

        <div class="flow-arrow">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" /></svg>
        </div>

        <!-- FASE 2 -->
        <section id="fase2" class="mb-8">
            <h2 class="phase-title"><span class="bg-amber-100 text-amber-700 px-3 py-1 rounded-full">FASE 2: LA CONVERSACIÓN</span></h2>
            <div class="flow-card">
                <h3 class="font-bold text-xl text-gray-800 mb-3 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-amber-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>
                    1. Observar (Aprender a Mirar)
                </h3>
                <div class="text-left space-y-3 text-gray-600">
                    <p>Para romper el ciclo de reaccionar impulsivamente, aprende a observar. Debes vigilar tres cosas:</p>
                    <p><strong>1. El momento crucial:</strong> Reconoce cuándo la conversación deja de ser rutinaria y se convierte en crucial.</p>
                    <p><strong>2. Las señales de peligro:</strong> Identifica cuándo los demás se sienten inseguros y recurren al <strong>Silencio</strong> (retener información) o la <strong>Violencia</strong> (forzar información).</p>
                    
                    <div>
                        <label for="stressStyle" class="font-semibold text-gray-700">3. ¿Cuál es tu estilo bajo estrés?</label>
                        <p class="text-sm text-gray-500">El primer indicador de problemas eres tú. Conocer tu tendencia es el primer paso para controlarla.</p>
                        <select id="stressStyle" class="w-full mt-2 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-400">
                            <option value="">-- Elige tu tendencia --</option>
                            <option value="silencio">Silencio</option>
                            <option value="violencia">Violencia</option>
                        </select>
                    </div>
                </div>

                <!-- Content for Silencio -->
                <div id="silencioContent" class="hidden mt-4 p-4 bg-blue-50 border-l-4 border-blue-400 rounded-r-lg text-left">
                    <h4 class="font-bold text-blue-800">Abordando el Silencio</h4>
                    <p class="text-blue-700 mt-2">El silencio consiste en retener información del fondo común de significados. Las formas más comunes son:</p>
                    <ul class="list-disc list-inside mt-2 space-y-1 text-blue-700">
                        <li><strong>Enmascarar:</strong> Minimizar o endulzar el mensaje. Sarcasmo, cumplidos ambiguos.</li>
                        <li><strong>Evitar:</strong> Apartarse de los temas sensibles.</li>
                        <li><strong>Retirarse:</strong> Abandonar la conversación por completo.</li>
                    </ul>
                    <p class="mt-2 text-blue-700"><strong>Primer paso:</strong> Reconoce que estás reteniendo información y pregúntate por qué. Probablemente sea por miedo a una reacción negativa.</p>
                </div>

                <!-- Content for Violencia -->
                <div id="violenciaContent" class="hidden mt-4 p-4 bg-red-50 border-l-4 border-red-400 rounded-r-lg text-left">
                    <h4 class="font-bold text-red-800">Abordando la Violencia</h4>
                    <p class="text-red-700 mt-2">La violencia consiste en intentar forzar tu punto de vista en los demás. Las formas más comunes son:</p>
                    <ul class="list-disc list-inside mt-2 space-y-1 text-red-700">
                        <li><strong>Controlar:</strong> Coartar las opiniones de otros, dominar la conversación.</li>
                        <li><strong>Etiquetar:</strong> Poner una etiqueta a personas o ideas para desestimarlas.</li>
                        <li><strong>Atacar:</strong> Pasar de discutir el tema a atacar a la persona (insultos, amenazas).</li>
                    </ul>
                     <p class="mt-2 text-red-700"><strong>Primer paso:</strong> Reconoce que tu objetivo ha cambiado de resolver el problema a ganar la discusión. Vuelve a tus verdaderos objetivos.</p>
                </div>
            </div>

            <div class="flow-arrow">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 13l-5 5m0 0l-5-5m5 5V6" /></svg>
            </div>

            <div class="flow-card text-center">
                <h3 class="font-semibold text-lg text-gray-700 mb-4">¿HAY FALTA DE SEGURIDAD?</h3>
                <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <button id="pathYes" class="path-button path-button-yes">SÍ, hay peligro</button>
                    <button id="pathNo" class="path-button path-button-no">NO, hay diálogo</button>
                </div>
            </div>

            <!-- Paths -->
            <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Path YES -->
                <div id="pathYesContent" class="hidden">
                    <div class="flow-card h-full border-2 border-red-200 bg-red-50">
                        <h3 class="font-bold text-xl text-red-800 mb-4 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" /></svg>
                            2. Restaurar Seguridad
                        </h3>
                        <p class="text-red-700 mb-4">Sal del contenido. Diagnostica el problema y, al mismo tiempo, gestiona tus propias emociones antes de volver a hablar.</p>
                        <div class="space-y-3">
                            <div class="detail-item" onclick="openModal('diagnosticar')">a) Diagnosticar y Usar Herramientas</div>
                            <div class="detail-item" onclick="openModal('anime')">b) Dominar mi Historia (Paso Interno)</div>
                        </div>
                    </div>
                </div>
                <!-- Path NO -->
                <div id="pathNoContent" class="hidden">
                    <div class="flow-card h-full border-2 border-green-200 bg-green-50">
                         <h3 class="font-bold text-xl text-green-800 mb-4 flex items-center">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" /></svg>
                            3. Dialogar (Método PRPO(A))
                        </h3>
                        <p class="text-green-700 mb-4">Expresa tu punto de vista de forma segura y respetuosa. Haz clic para ver el método:</p>
                         <div class="space-y-3">
                            <div class="detail-item" onclick="openModal('prpoa')">Ver el método PRPO(A)</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div class="flow-arrow">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" /></svg>
        </div>
        
        <!-- FASE 3 -->
        <section id="fase3">
            <h2 class="phase-title"><span class="bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full">FASE 3: ACCIÓN</span></h2>
            <div class="flow-card">
                <h3 class="font-bold text-xl text-gray-800 mb-3 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" /></svg>
                    4. Pasar a la Acción
                </h3>
                <p class="text-gray-600 mb-4">El diálogo no es la decisión final, sino el proceso para llegar a ella. Para evitar la "violación de las expectativas" y la inacción, es crucial clarificar cómo se tomarán las decisiones y quién hará qué.</p>
                <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold text-gray-700">Decidir cómo se decidirá:</h4>
                        <ul class="list-disc list-inside space-y-1 text-gray-600 mt-2">
                            <li><strong>Mando:</strong> Las decisiones se toman sin participación externa. Útil en emergencias o cuando un experto tiene la única respuesta.</li>
                            <li><strong>Consulta:</strong> Se invita a opinar, pero el responsable final toma la decisión. Es eficiente y gana ideas.</li>
                            <li><strong>Voto:</strong> Se usa cuando hay varias opciones buenas y se necesita rapidez. No usar si genera perdedores resentidos.</li>
                            <li><strong>Consenso:</strong> Todos deben estar de acuerdo. Es para decisiones complejas y de alto riesgo, pero consume mucho tiempo.</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-700">Documentar los resultados:</h4>
                        <p class="text-gray-600 mt-2">Un plan de acción claro aumenta la probabilidad de éxito. Asegúrate de definir:</p>
                        <ul class="list-['–'] list-inside ml-2 mt-1 space-y-1 font-medium text-gray-700">
                            <li><strong>¿Quién?</strong> (Asigna un nombre a cada tarea).</li>
                            <li><strong>¿Qué?</strong> (Sé específico sobre el entregable).</li>
                            <li><strong>¿Para cuándo?</strong> (Establece plazos claros).</li>
                            <li><strong>¿Cómo se hará el seguimiento?</strong> (Define cómo y cuándo se revisará el progreso).</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- PREPARATION BUTTON -->
        <div class="text-center my-12">
            <button id="startPreparationBtn" class="bg-gradient-to-r from-sky-500 to-indigo-600 text-white font-bold py-4 px-8 rounded-full shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300 text-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                Preparar mi Conversación Crucial
            </button>
        </div>
    </div>

    <!-- PREPARATION WIZARD -->
    <section id="preparationSection" class="hidden max-w-4xl mx-auto mb-12">
        <h2 class="phase-title"><span class="bg-teal-100 text-teal-700 px-3 py-1 rounded-full">HERRAMIENTA DE PREPARACIÓN</span></h2>
        <div class="flow-card">
            <div class="space-y-6">
                <div>
                    <h3 class="font-bold text-xl text-gray-800 mb-2">Parte 1: Empezar por el Corazón</h3>
                    <label for="prep-q1" class="font-semibold text-gray-700">¿Qué quiero realmente para mí?</label>
                    <textarea id="prep-q1" rows="3" class="prep-textarea" placeholder="Ej: Quiero expresar mi punto de vista sin generar un conflicto..."></textarea>
                </div>
                <div>
                    <label for="prep-q2" class="font-semibold text-gray-700">¿Qué quiero realmente para la otra persona?</label>
                    <textarea id="prep-q2" rows="3" class="prep-textarea" placeholder="Ej: Quiero que se sienta valorado y entienda mi perspectiva..."></textarea>
                </div>
                <div>
                    <label for="prep-q3" class="font-semibold text-gray-700">¿Qué quiero realmente para nuestra relación?</label>
                    <textarea id="prep-q3" rows="3" class="prep-textarea" placeholder="Ej: Quiero fortalecer la confianza y que podamos hablar de temas difíciles en el futuro..."></textarea>
                </div>
            </div>
            <div class="mt-8 pt-6 border-t">
                 <h3 class="font-bold text-xl text-gray-800 mb-2">Parte 2: Rechazar la Elección del Tonto</h3>
                 <div>
                    <label for="prep-q4" class="font-semibold text-gray-700">Describe la "elección del tonto" que temes tener que hacer.</label>
                    <textarea id="prep-q4" rows="3" class="prep-textarea" placeholder="Ej: Tengo que elegir entre ser honesto sobre el problema o ser leal a mi compañero..."></textarea>
                </div>
                <div class="mt-4">
                    <label for="prep-q5" class="font-semibold text-gray-700">Ahora, busca el "Y". ¿Cómo puedes lograr ambos resultados?</label>
                    <textarea id="prep-q5" rows="3" class="prep-textarea" placeholder="Ej: Puedo hablar con mi compañero de forma respetuosa sobre el impacto de su comportamiento Y a la vez reafirmar mi compromiso con el equipo..."></textarea>
                </div>
            </div>
            <div class="text-center mt-8">
                <button id="generateSummaryBtn" class="bg-green-600 text-white font-bold py-3 px-6 rounded-full hover:bg-green-700 transition-colors duration-300">
                    Generar Resumen de Preparación
                </button>
            </div>
        </div>
    </section>

    <!-- SUMMARY SECTION -->
    <section id="summarySection" class="hidden max-w-4xl mx-auto mb-12">
         <div class="flow-card bg-gray-50">
            <div id="summaryContent" class="prose max-w-none"></div>
            <div class="text-center mt-6">
                 <button id="copySummaryBtn" class="bg-gray-500 text-white font-bold py-2 px-4 rounded-full hover:bg-gray-600 transition-colors duration-300">
                    Copiar Resumen al Portapapeles
                </button>
            </div>
         </div>
    </section>


    <!-- Modal -->
    <div id="modal" class="modal-overlay" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-4">
                <h2 id="modalTitle" class="text-2xl font-bold text-gray-800"></h2>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="modalBody" class="text-gray-600 space-y-4 modal-body-content"></div>
        </div>
    </div>

    <script>
        // Modal and Path logic
        const pathYesBtn = document.getElementById('pathYes');
        const pathNoBtn = document.getElementById('pathNo');
        const pathYesContent = document.getElementById('pathYesContent');
        const pathNoContent = document.getElementById('pathNoContent');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');

        if(pathYesBtn) {
            pathYesBtn.addEventListener('click', () => {
                pathYesContent.classList.remove('hidden');
                pathNoContent.classList.add('hidden');
                pathYesBtn.classList.add('ring-2', 'ring-red-400');
                pathNoBtn.classList.remove('ring-2', 'ring-green-400');
            });
        }

        if(pathNoBtn) {
            pathNoBtn.addEventListener('click', () => {
                pathNoContent.classList.remove('hidden');
                pathYesContent.classList.add('hidden');
                pathNoBtn.classList.add('ring-2', 'ring-green-400');
                pathYesBtn.classList.remove('ring-2', 'ring-red-400');
            });
        }

        const modalData = {
            diagnosticar: {
                title: 'a) Diagnosticar y Usar Herramientas',
                body: `<p>Para restaurar la seguridad, primero debes saber qué se ha perdido. Elige una opción para ver las herramientas recomendadas y cómo usarlas:</p>
                       <div class="space-y-3 mt-4">
                           <div class="detail-item" onclick="showDiagnosisSuggestion('proposito')">¿Se ha perdido el Propósito Mutuo?</div>
                           <div class="detail-item" onclick="showDiagnosisSuggestion('respeto')">¿Se ha perdido el Respeto Mutuo?</div>
                       </div>
                       <div id="diagnosisSuggestion" class="hidden mt-4 p-4 bg-gray-100 border-l-4 rounded-r-lg"></div>`
            },
            anime: {
                title: 'b) Dominar mi Historia (Paso Interno)',
                body: `<p>Este es un paso <strong>interno y personal</strong> para gestionar tus propias emociones antes de hablar. Ocurre en el momento en que detectas peligro y sientes una fuerte reacción emocional. Para recuperar el control, deconstruye tu historia:</p>
                       <ol class="list-decimal list-inside mt-2 space-y-2">
                         <li><strong>A</strong> - Analizar mi comportamiento: ¿Estoy actuando con silencio o violencia?</li>
                         <li><strong>N</strong> - Notar mis sentimientos: ¿Qué emoción específica siento?</li>
                         <li><strong>I</strong> - Identificar mi historia: ¿Qué estoy pensando para justificar este sentimiento?</li>
                         <li><strong>M</strong> - Meditar sobre los hechos: Separa los hechos objetivos de tu interpretación.</li>
                         <li><strong>E</strong> - Escribir una historia útil: Cambia las historias de "villanos, víctimas e impotentes" por unas que abran al diálogo.</li>
                       </ol>
                       <h4>Cuidado con las "Tres Historias Astutas":</h4>
                       <ul class="list-disc list-inside mt-2 space-y-2">
                         <li><strong>Historia de Víctima:</strong> "No es culpa mía".</li>
                         <li><strong>Historia de Villano:</strong> "Es todo culpa tuya".</li>
                         <li><strong>Historia de Impotente:</strong> "No hay nada que pueda hacer".</li>
                       </ul>`
            },
            prpoa: {
                title: 'Método PRPO(A)',
                body: `<p>Una vez que la seguridad está garantizada, comparte tu perspectiva de forma que fomente el diálogo, no la defensa.</p>
                       <ol class="list-decimal list-inside mt-2 space-y-2">
                         <li><strong>P</strong> - Partir de los <strong>hechos</strong>: Son lo menos controvertido. Empieza con datos observables.</li>
                         <li><strong>R</strong> - Relatar tu <strong>historia</strong>: Explica la conclusión que sacas de esos hechos. Usa un lenguaje tentativo.</li>
                         <li><strong>P</strong> - Preguntar por la <strong>perspectiva</strong> del otro: Muestra humildad y curiosidad.</li>
                         <li><strong>O</strong> - Opinar con <strong>cautela</strong>: No presentes tu historia como un hecho.</li>
                         <li><strong>A</strong> - Animar a que <strong>pongan a prueba</strong> tu visión: Invita activamente al desacuerdo.</li>
                       </ol>`
            }
        };

        function openModal(type) {
            if (modalData[type]) {
                modalTitle.textContent = modalData[type].title;
                modalBody.innerHTML = modalData[type].body;
                modal.classList.add('active');
            }
        }

        function showDiagnosisSuggestion(type) {
            const suggestionBox = document.getElementById('diagnosisSuggestion');
            if (type === 'proposito') {
                suggestionBox.innerHTML = `
                    <h4 class="font-bold text-gray-800">Herramientas para restaurar el Propósito Mutuo</h4>
                    <p class="mt-2">Cuando los demás creen que no te importan sus objetivos, usa estas herramientas:</p>
                    
                    <h5 class="font-semibold mt-3 mb-1 text-gray-700">1. Usar Contraste (No/Sí)</h5>
                    <p>Es una herramienta de primeros auxilios para corregir malentendidos. Aclara lo que <strong>no</strong> intentas hacer, y luego lo que <strong>sí</strong> intentas hacer.</p>
                    <p class="mt-1 p-2 bg-white rounded-md border text-sm"><em>Ejemplo: "<strong>No quiero</strong> que pienses que estoy tratando de imponer mi decisión. <strong>Sí quiero</strong> asegurarme de que consideremos todos los ángulos antes de proceder."</em></p>
                    
                    <h5 class="font-semibold mt-3 mb-1 text-gray-700">2. Crear un Propósito Mutuo (PRPO)</h5>
                    <p>Cuando sus objetivos realmente son diferentes, busca un propósito superior que ambos compartan.</p>
                    <ol class="list-decimal list-inside mt-1 ml-4 text-sm">
                        <li><strong>P</strong>arar y comprometerse a buscar un propósito mutuo.</li>
                        <li><strong>R</strong>econocer el propósito detrás de la estrategia del otro ("¿Qué buscas lograr con eso?").</li>
                        <li><strong>P</strong>resentar tu propio propósito.</li>
                        <li><strong>O</strong>frecer nuevas estrategias (brainstorming) para alcanzar ese nuevo propósito común.</li>
                    </ol>
                `;
                suggestionBox.className = 'hidden mt-4 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded-r-lg text-left';
            } else if (type === 'respeto') {
                suggestionBox.innerHTML = `
                    <h4 class="font-bold text-gray-800">Herramientas para restaurar el Respeto Mutuo</h4>
                    <p class="mt-2">El respeto es como el aire: cuando se va, es lo único que importa. Usa estas herramientas:</p>
                    
                    <h5 class="font-semibold mt-3 mb-1 text-gray-700">1. Disculparse</h5>
                    <p>Si has hecho algo para faltarle al respeto a la otra persona, una disculpa sincera es el mejor punto de partida. Debe ser genuina, no un "lo siento, pero...".</p>
                    
                    <h5 class="font-semibold mt-3 mb-1 text-gray-700">2. Usar Contraste (No/Sí)</h5>
                    <p>También es excelente para restaurar el respeto cuando la otra persona siente que no la valoras, aunque no sea tu intención.</p>
                    <p class="mt-1 p-2 bg-white rounded-md border text-sm"><em>Ejemplo: "<strong>No quiero</strong> que pienses que no valoro tu experiencia. Al contrario, <strong>es precisamente por tu experiencia</strong> que quiero entender por qué ves las cosas de esta manera."</em></p>
                `;
                suggestionBox.className = 'hidden mt-4 p-4 bg-red-50 border-l-4 border-red-400 rounded-r-lg text-left';
            }
            suggestionBox.classList.remove('hidden');
        }

        function closeModal() {
            modal.classList.remove('active');
        }

        // Stress Style Dropdown Logic
        const stressStyleSelect = document.getElementById('stressStyle');
        const silencioContent = document.getElementById('silencioContent');
        const violenciaContent = document.getElementById('violenciaContent');

        stressStyleSelect.addEventListener('change', (event) => {
            const selectedValue = event.target.value;
            silencioContent.classList.add('hidden');
            violenciaContent.classList.add('hidden');

            if (selectedValue === 'silencio') {
                silencioContent.classList.remove('hidden');
            } else if (selectedValue === 'violencia') {
                violenciaContent.classList.remove('hidden');
            }
        });


        // Preparation Tool Logic
        const startPreparationBtn = document.getElementById('startPreparationBtn');
        const preparationSection = document.getElementById('preparationSection');
        const generateSummaryBtn = document.getElementById('generateSummaryBtn');
        const summarySection = document.getElementById('summarySection');
        const summaryContent = document.getElementById('summaryContent');
        const copySummaryBtn = document.getElementById('copySummaryBtn');

        startPreparationBtn.addEventListener('click', () => {
            preparationSection.classList.remove('hidden');
            window.scrollTo({
                top: preparationSection.offsetTop - 20,
                behavior: 'smooth'
            });
        });

        generateSummaryBtn.addEventListener('click', () => {
            const q1 = document.getElementById('prep-q1').value;
            const q2 = document.getElementById('prep-q2').value;
            const q3 = document.getElementById('prep-q3').value;
            const q4 = document.getElementById('prep-q4').value;
            const q5 = document.getElementById('prep-q5').value;

            if (!q1 && !q2 && !q3 && !q4 && !q5) {
                alert('Por favor, completa al menos un campo para generar el resumen.');
                return;
            }

            summaryContent.innerHTML = `
                <h3 class="text-2xl font-bold text-gray-800 mb-4">Resumen de Preparación</h3>
                <h4>Mis Objetivos (Empezar por el Corazón)</h4>
                <p><strong>Para mí:</strong> ${q1 || '<em>No especificado</em>'}</p>
                <p><strong>Para la otra persona:</strong> ${q2 || '<em>No especificado</em>'}</p>
                <p><strong>Para la relación:</strong> ${q3 || '<em>No especificado</em>'}</p>
                <h4 class="mt-4">Mi Enfoque (Evitar la Elección del Tonto)</h4>
                <p><strong>La elección que temo:</strong> ${q4 || '<em>No especificado</em>'}</p>
                <p><strong>Cómo buscaré el 'Y':</strong> ${q5 || '<em>No especificado</em>'}</p>
            `;
            summarySection.classList.remove('hidden');
             window.scrollTo({
                top: summarySection.offsetTop - 20,
                behavior: 'smooth'
            });
        });

        copySummaryBtn.addEventListener('click', () => {
            const q1 = document.getElementById('prep-q1').value;
            const q2 = document.getElementById('prep-q2').value;
            const q3 = document.getElementById('prep-q3').value;
            const q4 = document.getElementById('prep-q4').value;
            const q5 = document.getElementById('prep-q5').value;

            const textToCopy = `
Resumen de Preparación para Conversación Crucial
-------------------------------------------------

**Mis Objetivos (Empezar por el Corazón):**
- Para mí: ${q1 || 'No especificado'}
- Para la otra persona: ${q2 || 'No especificado'}
- Para la relación: ${q3 || 'No especificado'}

**Mi Enfoque (Evitar la Elección del Tonto):**
- La elección que temo: ${q4 || 'No especificado'}
- Cómo buscaré el 'Y': ${q5 || 'No especificado'}
            `.trim().replace(/    /g, '');

            const textarea = document.createElement('textarea');
            textarea.value = textToCopy;
            document.body.appendChild(textarea);
textarea.select();
            try {
                document.execCommand('copy');
                copySummaryBtn.textContent = '¡Copiado!';
                setTimeout(() => {
                    copySummaryBtn.textContent = 'Copiar Resumen al Portapapeles';
                }, 2000);
            } catch (err) {
                console.error('Error al copiar texto: ', err);
                alert('No se pudo copiar el texto. Por favor, hazlo manualmente.');
            }
            document.body.removeChild(textarea);
        });

    </script>

</body>
</html>
